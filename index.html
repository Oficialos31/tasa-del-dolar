<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasa VE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        /* Base styles for themes */
        .theme-dark {
            --bg-color: #0d1117;
            --text-color: #c9d1d9;
            --card-bg: #161b22;
            --border-color: #30363d;
            --accent-color: #10B981; /* Verde esmeralda (Green-400) */
            --secondary-text: #8b949e;
            --gradient-start: #10B981;
            --gradient-end: #059669;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 0;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .card { background-color: var(--card-bg); }
        .border-gray-700 { border-color: var(--border-color); }
        .text-green-400 { color: var(--accent-color); }
        .text-gray-400 { color: var(--secondary-text); }
        
        /* General element colors for both themes */
        .gradient-button {
            background-image: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2); /* Sombra con color de acento */
            transition: all 0.3s ease;
        }

        .gradient-button:hover {
            background-image: linear-gradient(to right, var(--gradient-end), var(--gradient-start));
            box-shadow: 0 6px 12px rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
        }

        .currency-select, .converter-input {
            background-color: var(--card-bg);
            color: var(--text-color);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease-in-out;
        }
        
        .currency-select:hover, .converter-input:hover { border-color: var(--accent-color); }
        
        .spinner {
            border: 4px solid var(--border-color);
            border-radius: 50%;
            border-top: 4px solid var(--accent-color);
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Animación para el efecto "Actualización Brillante" */
        @keyframes flash-rate {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { box-shadow: 0 0 10px 5px rgba(16, 185, 129, 0.4); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        .rate-flash {
            animation: flash-rate 0.8s ease-out;
        }

        .ad-container {
            width: 100%;
            padding: 1rem;
            margin-top: 2rem;
            background-color: var(--card-bg);
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-color);
        }

        .delete-history-item {
            background-color: #EF4444;
            color: white;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            font-size: 0.8rem;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }

        .delete-history-item:hover {
            background-color: #DC2626;
            transform: scale(1.1);
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Styles for the settings modal */
        #settings-menu {
            position: absolute;
            top: 65px;
            right: 1.5rem;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            z-index: 50;
            min-width: 250px;
            padding: 1rem;
            display: none;
        }
        .config-button {
            background-color: var(--border-color);
            color: var(--text-color);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease;
        }
        .config-button:hover {
            background-color: #3B4452;
        }
        .text-center {
            text-align: center;
        }

        /* Adjusted styles for the message box to appear at the top */
        #message-box {
            position: fixed;
            top: 2rem; 
            left: 50%;
            transform: translateX(-50%); 
            padding: 1rem 2rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            text-align: center;
            max-width: 80%;
            white-space: normal;
        }
        
        /* New styles for the gear icon animation and positioning */
        .gear-icon {
            transition: transform 0.3s ease-in-out;
        }

        .gear-icon:hover, .gear-icon.active {
            transform: rotate(45deg);
        }

        .fixed-gear {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 100;
        }
    </style>
</head>
<body class="theme-dark">

    <!-- Botón de configuración fijo en la esquina superior derecha -->
    <div class="fixed-gear">
        <button id="settings-btn" class="text-gray-400 hover:text-green-400 focus:outline-none transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 gear-icon" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c.996 .608 2.296 .32 2.572 -1.065z"></path>
                <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
            </svg>
        </button>
        <!-- Menú de configuración -->
        <div id="settings-menu" class="card rounded-xl p-4 flex flex-col space-y-4">
            <button id="show-time-btn" class="config-button">
                Ver Hora
            </button>
            <button id="clear-history-btn" class="config-button text-red-400">
                Limpiar Historial
            </button>
            <button id="refresh-page-btn" class="config-button">
                Reiniciar App
            </button>
            <div class="text-center text-sm text-gray-500 pt-2">
                Versión: <span id="app-version">1.0</span>
            </div>
        </div>
    </div>

    <main class="w-full h-full min-h-screen p-6 md:p-8 text-center flex flex-col justify-center animate-fade-in-section">
        <div class="flex items-center justify-center space-x-2 w-full mb-4">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-green-400">
                <!-- Icono de Divisa (Mantengo el diseño original para el logo) -->
                <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 18.5C12 18.2239 11.7761 18 11.5 18H10.5C10.2239 18 10 17.7761 10 17.5V14.5C10 14.2239 10.2239 14 10.5 14H13.5C13.7761 14 14 13.7761 14 13.5V10.5C14 10.2239 13.7761 10 13.5 10H10.5C10.2239 10 10 9.77614 10 9.5V6.5C10 6.22386 10.2239 6 10.5 6H11.5C11.7761 6 12 5.77614 12 5.5V5.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 5.5V18.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h1 class="text-3xl font-bold text-green-400">Tasa VE</h1>
        </div>
        
        <p class="text-gray-400 mb-6">Tasas Actualizadas del Banco Central de Venezuela</p>
        
        <div class="animated-bar w-full h-1 rounded-full mb-6"></div>

        <!-- ÍCONOS REALES: Selectores actualizados con emojis de bandera -->
        <div class="flex justify-center mb-6">
            <select id="currency-display-select" class="currency-select w-full">
                <option value="USD">🇺🇸 Dólar (USD)</option>
                <option value="EUR">🇪🇺 Euro (EUR)</option>
                <option value="USDT">₮ USDT (Tether)</option>
            </select>
        </div>

        <div id="loading" class="flex items-center justify-center space-x-2 text-gray-500 text-lg mb-4">
            <div class="spinner"></div>
            <span>Cargando tasa...</span>
        </div>
        
        <div id="rate-display" class="hidden">
            <div class="card p-4 rounded-lg mb-4 w-full">
                <p class="text-xl text-gray-400">Valor actual:</p>
                <div class="flex items-center justify-center space-x-2">
                    <!-- El efecto de "Actualización Brillante" se activa con la clase 'rate-flash' en JS -->
                    <p class="text-4xl sm:text-5xl font-bold text-green-400 mt-1 mr-2" id="currency-rate">Cargando...</p>
                    <button id="copy-btn" class="text-gray-400 hover:text-green-400 focus:outline-none transition-colors" title="Copiar Tasa">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-2M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2A2 2 0 0114 5m-5 8h4m-4 4h4" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- FUENTE DE DATOS VISIBLE -->
            <div id="source-label" class="text-sm text-gray-500 mt-2 mb-4">
                <p id="source-text" class="font-semibold"></p>
            </div>
            
            <!-- DISCLAIMER DE USDT: Más prominente y bien ubicado -->
            <div id="usdt-notice" class="card p-3 rounded-xl text-sm text-red-400 border border-red-500 hidden">
                <p>⚠️ **ATENCIÓN:** Tasa USDT basada en promedio P2P. Valor altamente referencial, no oficial. ¡Opera con cautela!</p>
            </div>

            <div class="text-sm text-gray-500 mt-4 flex flex-col items-center">
                <!-- TEXTO ACTUALIZADO: "Fecha Actual:" -->
                <p><span id="last-updated-label">Fecha Actual:</span> <span id="last-updated" class="font-bold">Cargando...</span></p>
            </div>
        </div>
        <div id="error-message" class="hidden text-red-400 text-sm mt-2"></div>

        <button id="refresh-btn" class="w-full mt-4 text-white font-semibold py-3 px-4 rounded-xl gradient-button pulse-animation">
            Actualizar Tasa
        </button>

        <div class="mt-8 pt-6 border-t border-gray-700 text-left">
            <h2 class="text-2xl font-bold text-green-400 mb-4">Conversor de Divisas</h2>
            
            <div class="flex justify-center mb-4">
                <button id="conversion-toggle-btn" class="w-full text-white card flex items-center justify-center space-x-2 p-3 rounded-lg focus:outline-none transition-colors border border-gray-700 hover:border-green-400">
                    <span id="toggle-text">Divisa a Bolívares</span>
                    <svg id="toggle-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform transition-transform duration-300" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>

            <div class="flex flex-col space-y-4 mb-4 items-center justify-center">
                <input type="number" id="amount-input" class="converter-input w-full p-3" placeholder="Cantidad a convertir">
                <select id="currency-select" class="converter-input w-full p-3">
                    <!-- ÍCONOS REALES: Selectores de conversión con emojis de bandera -->
                    <option value="USD">🇺🇸 Dólares (USD)</option>
                    <option value="EUR">🇪🇺 Euros (EUR)</option>
                    <option value="USDT">₮ USDT (Tether)</option>
                </select>
            </div>
            
            <button id="convert-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                Convertir
            </button>
            
            <div id="conversion-result" class="mt-4 p-4 card rounded-lg hidden">
                <div id="converted-value" class="text-3xl font-bold text-green-400 mb-2"></div>
            </div>
        </div>

        <div class="mt-8 pt-6 border-t border-gray-700 text-left">
            <h2 class="text-2xl font-bold text-green-400 mb-4">Historial de Conversiones</h2>
            <ul id="history-list" class="space-y-2 text-gray-400"></ul>
        </div>

        <div class="ad-container">
            <p>Espacio reservado para anuncio.</p>
        </div>
        
    </main>

    <div id="message-box" class="hidden">
        <p id="msg-text">¡Tasa copiada al portapapeles!</p>
    </div>
    
    <script type="module">
        let rates = {};
        let currentCurrency = 'USD';
        let conversionDirection = 'currency-to-bs';
        const HISTORY_KEY = 'conversionHistory';
        let msgTimeout;
        let refreshInterval;
        
        const settingsBtn = document.getElementById('settings-btn');
        const settingsMenu = document.getElementById('settings-menu');
        const gearIcon = document.querySelector('.gear-icon');
        const currencyRateElement = document.getElementById('currency-rate');


        settingsBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            const isMenuOpen = settingsMenu.style.display === 'block';
            if (isMenuOpen) {
                settingsMenu.style.display = 'none';
                gearIcon.classList.remove('active');
            } else {
                settingsMenu.style.display = 'block';
                gearIcon.classList.add('active');
            }
        });

        document.getElementById('refresh-page-btn').addEventListener('click', () => {
            window.location.reload();
        });

        document.getElementById('conversion-toggle-btn').addEventListener('click', () => {
            const toggleIcon = document.getElementById('toggle-icon');
            if (conversionDirection === 'currency-to-bs') {
                document.getElementById('toggle-text').textContent = 'Bolívares a Divisa';
                toggleIcon.style.transform = 'rotate(180deg)';
                conversionDirection = 'bs-to-currency';
            } else {
                document.getElementById('toggle-text').textContent = 'Divisa a Bolívares';
                toggleIcon.style.transform = 'rotate(0deg)';
                conversionDirection = 'currency-to-bs';
            }
            updateConversionInputPlaceholder();
        });

        function showCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-VE', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
            showMessage(`Hora actual: ${timeString}`, 5000);
        }

        function showMessage(message, duration = 3000) {
            const msgBox = document.getElementById('message-box');
            const msgText = document.getElementById('msg-text');
            msgText.textContent = message;
            
            clearTimeout(msgTimeout);
            
            msgBox.style.display = 'block';
            setTimeout(() => {
                msgBox.style.opacity = 1;
            }, 10);
            
            msgTimeout = setTimeout(() => {
                hideMessage();
            }, duration);
        }

        function hideMessage() {
            const msgBox = document.getElementById('message-box');
            msgBox.style.opacity = 0;
            setTimeout(() => {
                msgBox.style.display = 'none';
            }, 300);
        }
        
        function copyToClipboard() {
            // Se actualiza para copiar SOLO el número de la tasa (sin el símbolo Bs)
            const rateText = currencyRateElement.textContent.trim().split(' ')[1]; 
            
            const tempInput = document.createElement('textarea');
            tempInput.value = rateText; // Copia solo el valor
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);

            showMessage(`¡Valor de la Tasa (${rateText}) copiado!`, 3000);
        }

        /**
         * Aplica la animación de flash al número de la tasa
         */
        function applyFlashEffect() {
            currencyRateElement.classList.remove('rate-flash');
            // Forzar un reflow para que la animación se reinicie
            void currencyRateElement.offsetWidth; 
            currencyRateElement.classList.add('rate-flash');
            // Quitar la clase después de que termine la animación (800ms)
            setTimeout(() => {
                currencyRateElement.classList.remove('rate-flash');
            }, 800);
        }

        function updateUIWithRates(data, isUpdate) {
            rates = data.rates;
            
            const formattedDate = new Intl.DateTimeFormat('es-VE', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            }).format(new Date(data.timestamp));

            document.getElementById('last-updated').textContent = formattedDate;
            // TEXTO ACTUALIZADO: "Fecha Actual:"
            document.getElementById('last-updated-label').textContent = 'Fecha Actual:';
            
            updateDisplay(currentCurrency, isUpdate); 
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('rate-display').classList.remove('hidden');
            updateConversionInputPlaceholder();
        }
        
        function updateDisplay(currency, isUpdate = false) {
            const rateInfo = rates[currency];
            const usdtNotice = document.getElementById('usdt-notice');
            const sourceTextElement = document.getElementById('source-text');
            
            currentCurrency = currency;

            if (currency === 'USDT') {
                sourceTextElement.textContent = 'Fuente: Promedio P2P de Cripto-Exchanges';
                usdtNotice.classList.remove('hidden');
            } else {
                sourceTextElement.textContent = 'Fuente: Banco Central de Venezuela (BCV)';
                usdtNotice.classList.add('hidden');
            }

            if (rateInfo) {
                // Formatear el número para usar punto como separador decimal y asegurar 2 decimales
                const formattedRate = rateInfo.value.toLocaleString('en-US', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                });

                currencyRateElement.textContent = `${rateInfo.symbol} ${formattedRate}`;
                
                // Activar el efecto de flash solo si es una actualización o carga inicial
                if (isUpdate) {
                    applyFlashEffect();
                }
                
                document.getElementById('currency-select').value = currency;
            }
        }

        function updateConversionInputPlaceholder() {
            const amountInput = document.getElementById('amount-input');
            const currencySelect = document.getElementById('currency-select');
            const selectedCurrency = currencySelect.value;
            const rateInfo = rates[selectedCurrency];
            
            const currencyLabel = currencySelect.options[currencySelect.selectedIndex].text.split(' ')[0]; // Obtiene el emoji/símbolo para el placeholder

            if (conversionDirection === 'bs-to-currency') {
                amountInput.placeholder = 'Cantidad en Bolívares (Bs)';
            } else {
                amountInput.placeholder = `Cantidad en ${currencyLabel} (${rateInfo.displaySymbol})`;
            }
        }

        function convertCurrency() {
            const amountInput = document.getElementById('amount-input');
            const currencySelect = document.getElementById('currency-select');
            const conversionResultDiv = document.getElementById('conversion-result');
            const convertedValueDiv = document.getElementById('converted-value');
            
            const amount = parseFloat(amountInput.value);
            const currency = currencySelect.value;
            const rateInfo = rates[currency];

            if (isNaN(amount) || amount <= 0) {
                showMessage("Por favor, ingrese una cantidad válida.", 3000);
                return;
            }
            if (!rateInfo) {
                showMessage("La tasa no está cargada. Por favor, espere a que se actualice o recargue la página.", 3000);
                return;
            }
            
            let convertedValue;
            let fromCurrency, toCurrency, fromSymbol, toSymbol;

            if (conversionDirection === 'bs-to-currency') {
                convertedValue = (amount / rateInfo.value);
                fromCurrency = 'Bolívares';
                toCurrency = currency;
                fromSymbol = 'Bs';
                toSymbol = rateInfo.displaySymbol;
            } else {
                convertedValue = (amount * rateInfo.value);
                fromCurrency = currency;
                toCurrency = 'Bolívares';
                fromSymbol = rateInfo.displaySymbol;
                toSymbol = 'Bs';
            }
            
            // Formatear el resultado de la conversión para usar punto como separador decimal
            const formattedConvertedValue = convertedValue.toLocaleString('en-US', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            });

            convertedValueDiv.textContent = `${toSymbol} ${formattedConvertedValue}`;
            saveConversionToHistory(amount, fromCurrency, toCurrency, formattedConvertedValue, fromSymbol, toSymbol);
            conversionResultDiv.classList.remove('hidden');
        }
        
        function saveConversionToHistory(amount, fromCurrency, toCurrency, result, fromSymbol, toSymbol) {
            let history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
            const timestamp = new Date().toLocaleString('es-VE');
            history.unshift({ amount, fromCurrency, toCurrency, result, timestamp, fromSymbol, toSymbol });
            if (history.length > 10) {
                history.pop();
            }
            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            loadHistory();
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            if (history.length === 0) {
                historyList.innerHTML = '<p class="text-center text-gray-500">Aún no hay conversiones en tu historial.</p>';
            } else {
                history.forEach((item, index) => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('card', 'p-3', 'rounded-lg', 'history-item', 'border', 'border-gray-700');
                    listItem.innerHTML = `
                        <div>
                            <p class="text-sm"><span class="font-bold">${item.amount.toLocaleString('en-US')} ${item.fromSymbol}</span> a <span class="text-green-400 font-bold">${item.result} ${item.toSymbol}</span></p>
                            <p class="text-xs text-gray-500">${item.timestamp}</p>
                        </div>
                        <button class="delete-history-item" data-index="${index}">
                            &times;
                        </button>
                    `;
                    historyList.appendChild(listItem);
                });
                document.querySelectorAll('.delete-history-item').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const index = event.target.dataset.index;
                        deleteHistoryItem(index);
                    });
                });
            }
        }

        function clearHistory() {
            localStorage.removeItem(HISTORY_KEY);
            loadHistory();
            showMessage("Historial de conversiones limpiado.", 3000);
        }

        function deleteHistoryItem(index) {
            let history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
            history.splice(index, 1);
            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            loadHistory();
            showMessage("Conversión eliminada del historial.", 3000);
        }

        /**
         * Simula la carga de tasas (aquí iría la llamada a la API en el futuro)
         */
        function initRates(isManualUpdate = false) {
             const data = {
                rates: {
                    // Simulación de tasas actualizadas
                    'USD': { value: 207.89, symbol: 'Bs', conversion: 207.89, displaySymbol: '$' },
                    'EUR': { value: 242.21, symbol: 'Bs', conversion: 242.21, displaySymbol: '€' },
                    'USDT': { value: 309.40, symbol: 'Bs', conversion: 309.40, displaySymbol: '₮' },
                },
                timestamp: Date.now()
            };
            updateUIWithRates(data, isManualUpdate);
        }
        
        // Event listeners
        document.getElementById('convert-btn').addEventListener('click', convertCurrency);
        document.getElementById('copy-btn').addEventListener('click', copyToClipboard);
        document.getElementById('clear-history-btn').addEventListener('click', clearHistory);
        
        // MODIFICACIÓN CRÍTICA: El botón ahora recarga la página completamente.
        document.getElementById('refresh-btn').addEventListener('click', (e) => {
            e.preventDefault();
            window.location.reload(); 
        });

        document.getElementById('currency-display-select').addEventListener('change', (event) => {
            updateDisplay(event.target.value, true); // Flash cuando se cambia la divisa
        });
        document.getElementById('currency-select').addEventListener('change', () => {
            updateConversionInputPlaceholder();
        });
        document.getElementById('show-time-btn').addEventListener('click', showCurrentTime);

        window.onclick = function(event) {
            const settingsMenu = document.getElementById('settings-menu');
            const settingsBtn = document.getElementById('settings-btn');
            const gearIcon = document.querySelector('.gear-icon');
            if (!settingsBtn.contains(event.target) && !settingsMenu.contains(event.target)) {
                settingsMenu.style.display = 'none';
                gearIcon.classList.remove('active');
            }
        }
        
        function handleVisibilityChange() {
            if (document.hidden) {
                // Si la pestaña está en segundo plano, inicia la auto-actualización
                if (!refreshInterval) {
                    refreshInterval = setInterval(() => {
                        // En un app real, aquí se llamaría a la API sin recargar toda la página.
                        initRates();
                    }, 20000); 
                }
            } else {
                // Si la pestaña está en primer plano, detiene la auto-actualización
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
            }
        }
        document.addEventListener("visibilitychange", handleVisibilityChange);

        window.onload = () => {
            initRates(true); // Activar flash en la carga inicial
            loadHistory();
            updateConversionInputPlaceholder();
        };
    </script>
</body>
</html>
